This folder contains Django `django.contrib` system migrations for `contenttypes`, `sessions`, `auth`, and `admin` defaults.

You can see a list of the default migrations and their status with:

```sh
docker compose run --rm django-web python manage.py showmigrations
```

SQL was generated by running a command like this with each app + migration:

```sh
docker compose run --rm django-web python manage.py sqlmigrate contenttypes 0001_initial
```

while stripping out lines matching `/(BEGIN;|COMMIT;)`.

Something like this should work:

```python
from datetime import datetime
import os

BASE_VERSION = os.getenv('BASE_VERSION')
COUNT = os.getenv('MINOR_VERSION')

# the name of a django.contrib app like 'auth'
app = os.getenv('DJANGO_APP')

# the name of the valid migration like '0001_initial'
migration = os.getenv('DJANGO_MIGRATION')

command = [
    "docker", "compose", "run", "--rm", "django-web", "python", "manage.py", "sqlmigrate", app, migration
]

outfile = Path(f"V{BASE_VERSION}.{COUNT}__{APP}__{MIGRATION}.sql")
outpath = Path(".") / "flyway" / "sql" / "django_migrations" / outfile

print(f"\033[2m{' '.join(command)} > {outpath}\033[0m", file=sys.stderr, flush=True)

sql_out = subprocess.run(
    command,
    capture_output=True
)

# flyway manages transactions, so we need to strip Django's txn management
sql_string = sql_out.stdout.decode('utf-8')
filtered_sql = re.sub(r'^(BEGIN;|COMMIT;)\n?', '', sql_string, flags=re.MULTILINE)

with open(outpath, 'w') as outf:
    outf.write(f"-- generated {datetime.now()}\n\n")
    outf.write(filtered_sql)
```

## What about the actual django migrations?

Django really wants to manage migrations, but that's flyway's job.

You can populate the django migration history table to prevent it from complaining about unprocessed migrations with the `migrate --fake` command:

```sh
docker compose run --rm django-web python manage.py migrate --fake
```